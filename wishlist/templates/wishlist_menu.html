{% load static %}
<div class="flex gap-12 justify-center">
    <section class="w-full bg-gray-50 py-8 antialiased dark:bg-gray-900 md:py-12">
        <div class="mx-auto max-w-screen-xl px-4 2xl:px-0">
            <!-- Heading & Filters -->
            <div class="mb-4 items-end justify-between space-y-4 sm:flex sm:space-y-0 md:mb-8">
                <div>
                    <nav class="flex" aria-label="Breadcrumb">
                        <ol class="inline-flex items-center space-x-1 md:space-x-2 rtl:space-x-reverse">
                        <li class="inline-flex items-center">
                            <a href="#" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-orange-600 dark:text-gray-400 dark:hover:text-white">
                                <svg class="me-2.5 h-3 w-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
                                </svg>                                                                   
                            Wishlist
                            </a>
                        </li>
                        </ol>
                    </nav>
                </div>
            </div>
            
            {% if wishlist %}
                <ul class="list-disc pl-5">
                    {% for wishlist_item in wishlist %}
                        <div id="wishlist-item-{{ product.id }}">
                            <button class="decrement-btn" data-product-id="{{ product.id }}">-</button>
                            <span id="wishlist-item-quantity-{{ product.id }}">{{ wishlist_item.quantity }}</span>
                            <button class="increment-btn" data-product-id="{{ product.id }}">+</button>
                        </div>
                    {% endfor %}
                </ul>
            {% else %}
                <h1 class="mt-3 text-xl font-semibold text-gray-600 sm:text-2xl"> (You have no wishlisted products.)</h1>
            {% endif %}
            </div>
    </section>
    <script>
        document.querySelectorAll('.decrement-btn').forEach(button => {
            button.addEventListener('click', () => {
                const productId = button.getAttribute('data-product-id');
                adjustWishlistQuantity(productId, 'decrement');
            });
        });

        document.querySelectorAll('.increment-btn').forEach(button => {
            button.addEventListener('click', () => {
                const productId = button.getAttribute('data-product-id');
                adjustWishlistQuantity(productId, 'increment');
            });
        });

        function adjustWishlistQuantity(productId, action) {
            const quantityElement = $(`#wishlist-item-quantity-${productId}`);
            let currentQuantity = parseInt(quantityElement.text());

            let newQuantity = action === 'increment' ? currentQuantity + 1 : currentQuantity - 1;
            if (newQuantity < 1) {
                newQuantity = 1; 
            }

            $.ajax({
                url: `/wishlist/edit/${productId}/`,
                type: 'POST',
                data: {
                    'quantity': newQuantity,
                    'csrfmiddlewaretoken': '{{ csrf_token }}', 
                },
                success: function(response) {
                    if (response.deleted === false) {
                        quantityElement.text(response.quantity); 
                    } else if (response.sdeleted === true) {
                        $(`#wishlist-item-${productId}`).remove(); 
                    }
                },
                error: function() {
                    alert("There was an error updating the wishlist.");
                }
            });
        }
    </script>
</div>